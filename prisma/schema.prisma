// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat = "cjs"  //default is module / nextm
}

datasource db {
  provider = "postgresql"
}

model User {
  username String @id
  pwd String
  is_active Boolean

  roles UserRoleBridge[]
  pegawai Pegawai?
  
  rencanaAksi RencanaAksi[]
  progressRA ProgressRencanaAksi[]
  progressRAIntervensi ProgressRaIntervensi[]
  listLaporan LaporanCa[]
  listFile FileUpload[]

  @@map("user")
}

model Roles {
  description String @id
  user UserRoleBridge[]
  @@map("roles")
}

model UserRoleBridge {
  description String
  username String

  role Roles @relation(fields: [description], references: [description])
  user User @relation(fields: [username],references: [username])

  @@id([description,username])
  @@map("user_role_bridge")
}

model Pegawai {
  uuid String @id @default(uuid())
  fullname String?
  fullname_with_title String?
  nickname String?
  date_of_birth String?
  city_of_birth String?
  nip String?
  old_nip String?
  age Int
  username String? @unique 
  status_pegawai String?
  phone_number String?
  satker String?

  userObj User? @relation(fields: [username],references: [username])
  statusObj StatusPegawai? @relation(fields: [status_pegawai],references: [description])
  satkerObj Satker? @relation(fields: [satker],references: [code])
  @@map("pegawai")
}

model StatusPegawai {
  description String @id

  pegawai Pegawai[]
  @@map("status_pegawai")
}

model Satker {
  code String @id
  desc String
  type Int

  satkertype SatkerType @relation(fields: [type],references: [id])
  pegawai Pegawai[]
  rencanaAksi RencanaAksi[]
  @@map("satker")
}

model SatkerType {
  id Int @id
  desc String
  
  satker Satker[]
  @@map("satker_type")
}

model DukunganRB {
  id Int @id
  desc String 

  rencanaAksi RencanaAksi[]
  @@map("dukungan_rb")
}

model RencanaAksi {
  uuid String @id @default(uuid())
  nama_program String?
  uraian_kegiatan String?
  isu_strategis String?
  dukungan_rb Int
  output String?
  timeline String?
  ukuran_keberhasilan String? 
  outcome String? 
  keterangan String? 
  status Int 
  tahun Int 
  satker String
  last_updated DateTime @default(now()) @updatedAt
  created_by String

  dukunganRbObj DukunganRB @relation(fields: [dukungan_rb],references: [id])
  raStatusObj RencanaAksiStatus @relation(fields: [status],references: [id])
  satkerObj Satker @relation(fields: [satker],references: [code])
  creatorObj User @relation(fields: [created_by],references: [username])

  listOfProgress ProgressRencanaAksi[]

  @@map("rencana_aksi")
}

model RencanaAksiStatus {
  id Int @id
  desc String

  rencanaAksi RencanaAksi[]
  @@map("ra_status")
}

model ProgressRencanaAksi {
  uuid String @id @default(uuid()) 
  ra String 
  desc String?
  date String?
  pelaksanaan_pg Float
  capaian_pg Float
  bukti String? 
  notes String? 
  status Int
  created_by String
  last_updated DateTime @default(now()) @updatedAt

  raObj RencanaAksi @relation(fields: [ra],references: [uuid])
  statusObj ProgressStatus @relation(fields: [status],references: [id])
  creatorObj User @relation(fields: [created_by],references: [username])

  @@map("progress_ra")
}

model ProgressStatus {
  id Int @id
  desc String

  listOfProgress ProgressRencanaAksi[]
  listOfProgramIntervensi ProgramIntervensi[]

  @@map("progress_status")
}

model MasterIntervensiNasional {
  uuid String @id @default(uuid())
  nama_program String?
  uraian_kegiatan String?
  isu_strategis String? 
  output String? 
  timeline String? 
  ukuran_keberhasilan String? 
  outcome String? 
  keterangan String 
  tahun Int
  last_updated DateTime @default(now()) @updatedAt
  created_by String

  programIntervensiObj ProgramIntervensi[]

  @@map("master_intervensi_nasional")
}

model ProgramIntervensi {
  uuid String @id @default(uuid())
  intervensi String
  ukuran_keberhasilan String?
  timeline String?
  status Int
  satker String
  tahun Int 
  last_updated DateTime @default(now()) @updatedAt
  created_by String

  intervensiObj MasterIntervensiNasional @relation(fields: [intervensi],references: [uuid])
  statusObj ProgressStatus @relation(fields: [status],references: [id])
  progressObj ProgressRaIntervensi[]

  @@unique([intervensi,satker,tahun])
  @@map("program_intervensi")

}

model ProgressRaIntervensi {
  uuid String @id @default(uuid())
  ra String
  desc String?
  date String?
  pelaksanaan_pg Float
  capaian_pg Float
  bukti String?
  notes String?
  status Int
  created_by String
  last_updated DateTime @default(now()) @updatedAt

  creator User @relation(fields: [created_by],references: [username], onUpdate: Cascade)
  rancananAksi ProgramIntervensi @relation(fields: [ra],references: [uuid],onUpdate: Cascade, onDelete: Cascade)

  @@map("progress_ra_intervensi")
}

model FileUpload {
  uuid String @id @default(uuid())
  filename String 
  extension String
  size Int
  is_public Boolean @default(false)
  path String
  created_by String
  created_at DateTime @default(now())
  last_updated DateTime @default(now()) @updatedAt
  
  creatorObj User @relation(fields: [created_by],references: [username])
  laporanObj LaporanCa[]

  @@map("file_upload")
}

model LaporanCa{
  uuid String @id @default(uuid())
  triwulan Int
  tahun Int
  satker String
  bukti String
  created_by String
  created_at DateTime @default(now())
  last_updated DateTime @default(now()) @updatedAt

  creatorObj User @relation(fields: [created_by],references: [username])
  buktiObj FileUpload @relation(fields: [bukti],references: [uuid])

  @@map("laporan_ca")
  @@unique([triwulan,tahun,satker])
}

model IpDetector {
  uuid String @id @default(uuid())
  ip String @unique
  ips String
  path String
  created_at DateTime @default(now())
  last_updated DateTime @default(now()) @updatedAt

  @@map("ip_detector")
}